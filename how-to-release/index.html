<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://py.iceberg.apache.org/how-to-release/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>How to release - PyIceberg</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "How to release";
        var mkdocs_page_input_path = "how-to-release.md";
        var mkdocs_page_url = "/how-to-release/";
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> PyIceberg
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../configuration/">Configuration</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../cli/">CLI</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../api/">API</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Contributing</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../contributing/">Contributing</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../feature-support/">Feature support</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Releases</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../verify-release/">Verify a release</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">How to release</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#running-a-release-candidate">Running a release candidate</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vote-has-passed">Vote has passed</a>
    </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">PyIceberg</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Releases &raquo;</li>
      <li>How to release</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <!--
  - Licensed to the Apache Software Foundation (ASF) under one
  - or more contributor license agreements.  See the NOTICE file
  - distributed with this work for additional information
  - regarding copyright ownership.  The ASF licenses this file
  - to you under the Apache License, Version 2.0 (the
  - "License"); you may not use this file except in compliance
  - with the License.  You may obtain a copy of the License at
  -
  -   http://www.apache.org/licenses/LICENSE-2.0
  -
  - Unless required by applicable law or agreed to in writing,
  - software distributed under the License is distributed on an
  - "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  - KIND, either express or implied.  See the License for the
  - specific language governing permissions and limitations
  - under the License.
  -->

<h1 id="how-to-release">How to release</h1>
<p>The guide to release PyIceberg.</p>
<p>The first step is to publish a release candidate (RC) and publish it to the public for testing and validation. Once the vote has passed on the RC, the RC turns into the new release.</p>
<h2 id="running-a-release-candidate">Running a release candidate</h2>
<p>Make sure that you're on the version that you want to release. And that the version is correct in <code>pyproject.toml</code> and <code>pyiceberg/__init__.py</code>. Correct means that it reflects the version that you want to release, and doesn't contain any additional modifiers, such as <code>dev0</code>.</p>
<pre><code class="language-bash">export RC=rc1
export VERSION=0.1.0${RC}
export VERSION_WITHOUT_RC=${VERSION/rc?/}
export VERSION_BRANCH=${VERSION_WITHOUT_RC//./-}
export GIT_TAG=pyiceberg-${VERSION}

git tag -s ${GIT_TAG} -m &quot;PyIceberg ${VERSION}&quot;
git push apache ${GIT_TAG}

export GIT_TAG_REF=$(git show-ref ${GIT_TAG})
export GIT_TAG_HASH=${GIT_TAG_REF:0:40}
export LAST_COMMIT_ID=$(git rev-list ${GIT_TAG} 2&gt; /dev/null | head -n 1)
</code></pre>
<p>The <code>-s</code> option will sign the commit. If you don't have a key yet, you can find the instructions <a href="http://www.apache.org/dev/openpgp.html#key-gen-generate-key">here</a>. To install gpg on a M1 based Mac, a couple of additional steps are required: https://gist.github.com/phortuin/cf24b1cca3258720c71ad42977e1ba57</p>
<p>Next step is to create a source distribution (<code>sdist</code>) which will generate a <code>.tar.gz</code> with all the source files. These files need to be uploaded to the Apache SVN.</p>
<pre><code>poetry build
</code></pre>
<p>This will create two artifacts:</p>
<pre><code>Building pyiceberg (0.1.0)
  - Building sdist
  - Built pyiceberg-0.1.0.tar.gz
  - Building wheel
  - Built apache_iceberg-0.1.0-py3-none-any.whl
</code></pre>
<p>The <code>sdist</code> contains the source which can be used for checking licenses, and the wheel is a compiled version for quick installation.</p>
<p>Before committing the files to the Apache SVN artifact distribution SVN hashes need to be generated, and those need to be signed with gpg to make sure that they are authentic:</p>
<pre><code class="language-bash">for name in &quot;pyiceberg-${VERSION_WITHOUT_RC}-py3-none-any.whl&quot; &quot;pyiceberg-${VERSION_WITHOUT_RC}.tar.gz&quot;
do
    gpg --yes --armor --local-user fokko@apache.org --output &quot;dist/${name}.asc&quot; --detach-sig &quot;dist/${name}&quot;
    (cd dist/ &amp;&amp; shasum -a 512 &quot;${name}&quot; &gt; &quot;${name}.sha512&quot;)
done
</code></pre>
<p>Next step is to clone the Apache SVN, copy and commit the files:</p>
<pre><code class="language-bash">export SVN_TMP_DIR=/tmp/iceberg-${VERSION_BRANCH}/
svn checkout https://dist.apache.org/repos/dist/dev/iceberg $SVN_TMP_DIR

export SVN_TMP_DIR_VERSIONED=${SVN_TMP_DIR}pyiceberg-$VERSION/
mkdir -p $SVN_TMP_DIR_VERSIONED
cp dist/* $SVN_TMP_DIR_VERSIONED
svn add $SVN_TMP_DIR_VERSIONED
svn ci -m &quot;PyIceberg ${VERSION}&quot; ${SVN_TMP_DIR_VERSIONED}
</code></pre>
<p>Next step is to upload them to pypi. Please keep in mind that this <strong>won't</strong> bump the version for everyone that hasn't pinned their version, since it is set to a RC <a href="https://packaging.python.org/en/latest/guides/distributing-packages-using-setuptools/#pre-release-versioning">pre-release and those are ignored</a>.</p>
<pre><code>poetry version ${VERSION}
rm -rf dist/
poetry build
twine upload -s dist/*
</code></pre>
<p>Finally step is to generate the email what send to the dev mail list:</p>
<pre><code class="language-bash">cat &lt;&lt; EOF &gt; release-announcement-email.txt
To: dev@iceberg.apache.org
Subject: [VOTE] Release Apache PyIceberg $VERSION_WITHOUT_RC
Hi Everyone,

I propose that we release the following RC as the official PyIceberg $VERSION_WITHOUT_RC release.

The commit ID is $LAST_COMMIT_ID

* This corresponds to the tag: $GIT_TAG ($GIT_TAG_HASH)
* https://github.com/apache/iceberg/releases/tag/$GIT_TAG
* https://github.com/apache/iceberg/tree/$LAST_COMMIT_ID

The release tarball, signature, and checksums are here:

* https://dist.apache.org/repos/dist/dev/iceberg/pyiceberg-$VERSION/

You can find the KEYS file here:

* https://dist.apache.org/repos/dist/dev/iceberg/KEYS

Convenience binary artifacts are staged on pypi:

https://pypi.org/project/pyiceberg/$VERSION/

And can be installed using: pip3 install pyiceberg==$VERSION

Please download, verify, and test.

Please vote in the next 72 hours.
[ ] +1 Release this as PyIceberg $VERSION_WITHOUT_RC
[ ] +0
[ ] -1 Do not release this because...
EOF

cat release-announcement-email.txt
</code></pre>
<h2 id="vote-has-passed">Vote has passed</h2>
<p>Once the vote has been passed, the latest version can be pushed to PyPi. Check out the commit associated with the passing vote, and run:</p>
<pre><code class="language-bash">rm -rf dist/
poetry build
twine upload -s dist/*
</code></pre>
<p>Send out an announcement on the dev mail list:</p>
<pre><code>To: dev@iceberg.apache.org
Subject: [ANNOUNCE] Apache PyIceberg release &lt;VERSION&gt;

I'm pleased to announce the release of Apache PyIceberg &lt;VERSION&gt;!

Apache Iceberg is an open table format for huge analytic datasets. Iceberg
delivers high query performance for tables with tens of petabytes of data,
along with atomic commits, concurrent writes, and SQL-compatible table
evolution.

This Python release can be downloaded from: https://pypi.org/project/pyiceberg/&lt;VERSION&gt;/

Thanks to everyone for contributing!
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../verify-release/" class="btn btn-neutral float-left" title="Verify a release"><span class="icon icon-circle-arrow-left"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../verify-release/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
