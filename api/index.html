<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://py.iceberg.apache.org/api/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>API - PyIceberg</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "API";
        var mkdocs_page_input_path = "api.md";
        var mkdocs_page_url = "/api/";
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> PyIceberg
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../configuration/">Configuration</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../cli/">CLI</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">API</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#load-a-table">Load a table</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#create-a-table">Create a table</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#query-a-table">Query a table</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#apache-arrow">Apache Arrow</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#duckdb">DuckDB</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Contributing</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../contributing/">Contributing</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../feature-support/">Feature support</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Releases</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../verify-release/">Verify a release</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../how-to-release/">How to release</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">PyIceberg</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>API</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <!--
  - Licensed to the Apache Software Foundation (ASF) under one
  - or more contributor license agreements.  See the NOTICE file
  - distributed with this work for additional information
  - regarding copyright ownership.  The ASF licenses this file
  - to you under the Apache License, Version 2.0 (the
  - "License"); you may not use this file except in compliance
  - with the License.  You may obtain a copy of the License at
  -
  -   http://www.apache.org/licenses/LICENSE-2.0
  -
  - Unless required by applicable law or agreed to in writing,
  - software distributed under the License is distributed on an
  - "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  - KIND, either express or implied.  See the License for the
  - specific language governing permissions and limitations
  - under the License.
  -->

<h1 id="python-api">Python API</h1>
<p>PyIceberg is based around catalogs to load tables. First step is to instantiate a catalog that loads tables. Let's use the following configuration:</p>
<pre><code class="language-yaml">catalog:
  prod:
    uri: http://rest-catalog/ws/
    credential: t-1234:secret
</code></pre>
<p>Then load the <code>prod</code> catalog:</p>
<pre><code class="language-python">from pyiceberg.catalog import load_catalog

catalog = load_catalog(&quot;prod&quot;)

catalog.list_namespaces()
</code></pre>
<p>Returns two namespaces:</p>
<pre><code class="language-python">[(&quot;default&quot;,), (&quot;nyc&quot;,)]
</code></pre>
<p>Listing the tables in the <code>nyc</code> namespace:</p>
<pre><code class="language-python">catalog.list_tables(&quot;nyc&quot;)
</code></pre>
<p>Returns as list with tuples, containing a single table <code>taxis</code>:</p>
<pre><code class="language-python">[(&quot;nyc&quot;, &quot;taxis&quot;)]
</code></pre>
<h2 id="load-a-table">Load a table</h2>
<p>Loading the <code>taxis</code> table:</p>
<pre><code class="language-python">catalog.load_table(&quot;nyc.taxis&quot;)
# Equivalent to:
catalog.load_table((&quot;nyc&quot;, &quot;taxis&quot;))
# The tuple syntax can be used if the namespace or table contains a dot.
</code></pre>
<p>This returns a <code>Table</code> that represents an Iceberg table:</p>
<pre><code class="language-python">Table(
  identifier=('nyc', 'taxis'),
  metadata_location='s3a://warehouse/wh/nyc.db/taxis/metadata/00002-6ea51ce3-62aa-4197-9cf8-43d07c3440ca.metadata.json',
  metadata=TableMetadataV2(
    location='s3a://warehouse/wh/nyc.db/taxis',
    table_uuid=UUID('ebd5d172-2162-453d-b586-1cdce52c1116'),
    last_updated_ms=1662633437826,
    last_column_id=19,
    schemas=[Schema(
        NestedField(field_id=1, name='VendorID', field_type=LongType(), required=False),
        NestedField(field_id=2, name='tpep_pickup_datetime', field_type=TimestamptzType(), required=False),
        NestedField(field_id=3, name='tpep_dropoff_datetime', field_type=TimestamptzType(), required=False),
        NestedField(field_id=4, name='passenger_count', field_type=DoubleType(), required=False),
        NestedField(field_id=5, name='trip_distance', field_type=DoubleType(), required=False),
        NestedField(field_id=6, name='RatecodeID', field_type=DoubleType(), required=False),
        NestedField(field_id=7, name='store_and_fwd_flag', field_type=StringType(), required=False),
        NestedField(field_id=8, name='PULocationID', field_type=LongType(), required=False),
        NestedField(field_id=9, name='DOLocationID', field_type=LongType(), required=False),
        NestedField(field_id=10, name='payment_type', field_type=LongType(), required=False),
        NestedField(field_id=11, name='fare_amount', field_type=DoubleType(), required=False),
        NestedField(field_id=12, name='extra', field_type=DoubleType(), required=False),
        NestedField(field_id=13, name='mta_tax', field_type=DoubleType(), required=False),
        NestedField(field_id=14, name='tip_amount', field_type=DoubleType(), required=False),
        NestedField(field_id=15, name='tolls_amount', field_type=DoubleType(), required=False),
        NestedField(field_id=16, name='improvement_surcharge', field_type=DoubleType(), required=False),
        NestedField(field_id=17, name='total_amount', field_type=DoubleType(), required=False),
        NestedField(field_id=18, name='congestion_surcharge', field_type=DoubleType(), required=False),
        NestedField(field_id=19, name='airport_fee', field_type=DoubleType(), required=False)
      ),
      schema_id=0,
      identifier_field_ids=[]
    )],
    current_schema_id=0,
    partition_specs=[PartitionSpec(spec_id=0)],
    default_spec_id=0,
    last_partition_id=999,
    properties={
      'owner': 'root',
      'write.format.default': 'parquet'
    },
    current_snapshot_id=8334458494559715805,
    snapshots=[
      Snapshot(
        snapshot_id=7910949481055846233,
        parent_snapshot_id=None,
        sequence_number=None,
        timestamp_ms=1662489306555,
        manifest_list='s3a://warehouse/wh/nyc.db/taxis/metadata/snap-7910949481055846233-1-3eb7a2e1-5b7a-4e76-a29a-3e29c176eea4.avro',
        summary=Summary(
          Operation.APPEND,
          **{
            'spark.app.id': 'local-1662489289173',
            'added-data-files': '1',
            'added-records': '2979431',
            'added-files-size': '46600777',
            'changed-partition-count': '1',
            'total-records': '2979431',
            'total-files-size': '46600777',
            'total-data-files': '1',
            'total-delete-files': '0',
            'total-position-deletes': '0',
            'total-equality-deletes': '0'
          }
        ),
        schema_id=0
      ),
    ],
    snapshot_log=[
      SnapshotLogEntry(
        snapshot_id='7910949481055846233',
        timestamp_ms=1662489306555
      )
    ],
    metadata_log=[
      MetadataLogEntry(
        metadata_file='s3a://warehouse/wh/nyc.db/taxis/metadata/00000-b58341ba-6a63-4eea-9b2f-e85e47c7d09f.metadata.json',
        timestamp_ms=1662489306555
      )
    ],
    sort_orders=[SortOrder(order_id=0)],
    default_sort_order_id=0,
    refs={
      'main': SnapshotRef(
        snapshot_id=8334458494559715805,
        snapshot_ref_type=SnapshotRefType.BRANCH,
        min_snapshots_to_keep=None,
        max_snapshot_age_ms=None,
        max_ref_age_ms=None
      )
    },
    format_version=2,
    last_sequence_number=1
  )
)
</code></pre>
<h2 id="create-a-table">Create a table</h2>
<p>To create a table from a catalog:</p>
<pre><code class="language-python">from pyiceberg.catalog import load_catalog
from pyiceberg.schema import Schema
from pyiceberg.types import TimestampType, DoubleType, StringType, NestedField

schema = Schema(
    NestedField(
        field_id=1, name=&quot;datetime&quot;, field_type=TimestampType(), required=False
    ),
    NestedField(field_id=2, name=&quot;bid&quot;, field_type=DoubleType(), required=False),
    NestedField(field_id=3, name=&quot;ask&quot;, field_type=DoubleType(), required=False),
    NestedField(field_id=4, name=&quot;symbol&quot;, field_type=StringType(), required=False),
)

from pyiceberg.partitioning import PartitionSpec, PartitionField
from pyiceberg.transforms import DayTransform

partition_spec = PartitionSpec(
    PartitionField(
        source_id=1, field_id=1000, transform=DayTransform(), name=&quot;datetime_day&quot;
    )
)

from pyiceberg.table.sorting import SortOrder, SortField
from pyiceberg.transforms import IdentityTransform

sort_order = SortOrder(SortField(source_id=4, transform=IdentityTransform()))

catalog = load_catalog(&quot;prod&quot;)

catalog.create_table(
    identifier=&quot;default.bids&quot;,
    location=&quot;/Users/fokkodriesprong/Desktop/docker-spark-iceberg/wh/bids/&quot;,
    schema=schema,
    partition_spec=partition_spec,
    sort_order=sort_order,
)
</code></pre>
<p>Which returns a newly created table:</p>
<pre><code class="language-python">Table(
    identifier=('default', 'bids'),
    metadata_location='/Users/fokkodriesprong/Desktop/docker-spark-iceberg/wh/bids//metadata/00000-c8cd93ab-f784-474d-a167-b1a86b05195f.metadata.json',
    metadata=TableMetadataV2(
        location='/Users/fokkodriesprong/Desktop/docker-spark-iceberg/wh/bids/',
        table_uuid=UUID('38d4cb39-4945-4bf2-b374-984b5c4984d2'),
        last_updated_ms=1661847562069,
        last_column_id=4,
        schemas=[
            Schema(
                NestedField(field_id=1, name='datetime', field_type=TimestampType(), required=False),
                NestedField(field_id=2, name='bid', field_type=DoubleType(), required=False),
                NestedField(field_id=3, name='ask', field_type=DoubleType(), required=False),
                NestedField(field_id=4, name='symbol', field_type=StringType(), required=False)),
                schema_id=1,
                identifier_field_ids=[])
        ],
        current_schema_id=1,
        partition_specs=[
            PartitionSpec(
                PartitionField(source_id=1, field_id=1000, transform=DayTransform(), name='datetime_day'),))
        ],
        default_spec_id=0,
        last_partition_id=1000,
        properties={},
        current_snapshot_id=None,
        snapshots=[],
        snapshot_log=[],
        metadata_log=[],
        sort_orders=[
            SortOrder(order_id=1, fields=[SortField(source_id=4, transform=IdentityTransform(), direction=SortDirection.ASC, null_order=NullOrder.NULLS_FIRST)])
        ],
        default_sort_order_id=1,
        refs={},
        format_version=2,
        last_sequence_number=0
    )
)
</code></pre>
<h2 id="query-a-table">Query a table</h2>
<p>To query a table, a table scan is needed. A table scan accepts a filter, columns and optionally a snapshot ID:</p>
<pre><code class="language-python">from pyiceberg.catalog import load_catalog
from pyiceberg.expressions import GreaterThanOrEqual

catalog = load_catalog(&quot;default&quot;)
table = catalog.load_table(&quot;nyc.taxis&quot;)

scan = table.scan(
    row_filter=GreaterThanOrEqual(&quot;trip_distance&quot;, 10.0),
    selected_fields=(&quot;VendorID&quot;, &quot;tpep_pickup_datetime&quot;, &quot;tpep_dropoff_datetime&quot;),
)

[task.file.file_path for task in scan.plan_files()]
</code></pre>
<p>The low level API <code>plan_files</code> methods returns a set of tasks that provide the files that might contain matching rows:</p>
<pre><code class="language-json">['s3a://warehouse/wh/nyc/taxis/data/00003-4-42464649-92dd-41ad-b83b-dea1a2fe4b58-00001.parquet']
</code></pre>
<p>In this case it is up to the engine itself to filter the file itself. Below, <code>to_arrow()</code> and <code>to_duckdb()</code> that already do this for you.</p>
<h3 id="apache-arrow">Apache Arrow</h3>
<div class="admonition note">
<p class="admonition-title">Requirements</p>
<p>This requires <a href="../">PyArrow to be installed</a></p>
</div>
<p>Using PyIceberg it is filter out data from a huge table and pull it into a PyArrow table:</p>
<pre><code class="language-python">table.scan(
    row_filter=GreaterThanOrEqual(&quot;trip_distance&quot;, 10.0),
    selected_fields=(&quot;VendorID&quot;, &quot;tpep_pickup_datetime&quot;, &quot;tpep_dropoff_datetime&quot;),
).to_arrow()
</code></pre>
<p>This will return a PyArrow table:</p>
<pre><code>pyarrow.Table
VendorID: int64
tpep_pickup_datetime: timestamp[us, tz=+00:00]
tpep_dropoff_datetime: timestamp[us, tz=+00:00]
----
VendorID: [[2,1,2,1,1,...,2,2,2,2,2],[2,1,1,1,2,...,1,1,2,1,2],...,[2,2,2,2,2,...,2,6,6,2,2],[2,2,2,2,2,...,2,2,2,2,2]]
tpep_pickup_datetime: [[2021-04-01 00:28:05.000000,...,2021-04-30 23:44:25.000000]]
tpep_dropoff_datetime: [[2021-04-01 00:47:59.000000,...,2021-05-01 00:14:47.000000]]
</code></pre>
<p>This will only pull in the files that that might contain matching rows.</p>
<h3 id="duckdb">DuckDB</h3>
<div class="admonition note">
<p class="admonition-title">Requirements</p>
<p>This requires <a href="../">DuckDB to be installed</a>.</p>
</div>
<p>A table scan can also be converted into a in-memory DuckDB table:</p>
<pre><code class="language-python">con = table.scan(
    row_filter=GreaterThanOrEqual(&quot;trip_distance&quot;, 10.0),
    selected_fields=(&quot;VendorID&quot;, &quot;tpep_pickup_datetime&quot;, &quot;tpep_dropoff_datetime&quot;),
).to_duckdb(table_name=&quot;distant_taxi_trips&quot;)
</code></pre>
<p>Using the cursor that we can run queries on the DuckDB table:</p>
<pre><code class="language-python">print(
    con.execute(
        &quot;SELECT tpep_dropoff_datetime - tpep_pickup_datetime AS duration FROM distant_taxi_trips LIMIT 4&quot;
    ).fetchall()
)
[
    (datetime.timedelta(seconds=1194),),
    (datetime.timedelta(seconds=1118),),
    (datetime.timedelta(seconds=1697),),
    (datetime.timedelta(seconds=1581),),
]
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../cli/" class="btn btn-neutral float-left" title="CLI"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../contributing/" class="btn btn-neutral float-right" title="Contributing">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../cli/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../contributing/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
